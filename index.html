<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotograma Falado</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Rotograma Falado</h1>
    <p>Pressione o botão para iniciar a verificação de localização.</p>
    <button onclick="startTracking()">Iniciar</button>
    <p id="status">Aguardando...</p>

    <script>
        // Coordenadas do ponto alvo (substitua pelas coordenadas desejadas)
        const destino = {
            latitude: -23.55018, // Exemplo: São Paulo, Brasil
            longitude: -46.63037
        };
        
        const raioPermitido = 50; // Raio de proximidade em metros
        let falou = false; // Para evitar repetição desnecessária

        function startTracking() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(verificarLocalizacao, erroLocalizacao, {
                    enableHighAccuracy: true,
                    maximumAge: 0
                });
                document.getElementById("status").innerText = "Rastreamento iniciado...";
            } else {
                alert("Geolocalização não é suportada neste navegador.");
            }
        }
        
        function verificarLocalizacao(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            document.getElementById("status").innerText = `Localização atual: ${lat.toFixed(5)}, ${lon.toFixed(5)}`;
            
            const distancia = calcularDistancia(lat, lon, destino.latitude, destino.longitude);
            
            if (distancia <= raioPermitido && !falou) {
                falarTexto("Você chegou ao destino!");
                falou = true; // Evita repetir
            }
        }
        
        function erroLocalizacao(error) {
            console.error("Erro ao obter localização: ", error.message);
        }
        
        function calcularDistancia(lat1, lon1, lat2, lon2) {
            const R = 6371000; // Raio da Terra em metros
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) + 
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c; // Distância em metros
        }
        
        function falarTexto(mensagem) {
            const synth = window.speechSynthesis;
            const utterance = new SpeechSynthesisUtterance(mensagem);
            utterance.lang = "pt-BR";
            synth.speak(utterance);
        }
    </script>
</body>
</html>
